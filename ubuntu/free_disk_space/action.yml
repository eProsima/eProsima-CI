name: 'free_disk_space'

runs:
  using: composite
  steps:

    - name: Free disk space
      shell: bash
      run: |
        set -euxo pipefail
        # Check space before cleanup
        echo "Disk space before cleanup:"
        df -h /
        # Remove unnecessary apt packages
        sudo apt-get remove -y '^dotnet-.*'
        sudo apt-get remove -y '^llvm-.*'
        sudo apt-get remove -y 'php.*'
        sudo apt-get remove -y microsoft-edge-stable azure-cli google-cloud-cli google-chrome-stable firefox
        sudo apt-get autoremove -y
        sudo apt-get clean
        # Remove unnecessary files and directories
        sudo rm -rf /usr/share/dotnet \
                      /usr/local/lib/android \
                      /opt/ghc \
                      /usr/local/share/boost \
                      /usr/local/share/chromium \
                      /usr/local/.ghcup || true
        # Docker images (if any)
        docker image prune -af || true
        # Snap packages (if any)
        sudo rm -rf /var/lib/snapd/snaps/* || true
        # Check space after cleanup
        echo "Disk space after cleanup:"
        df -h /
